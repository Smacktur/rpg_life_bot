# Инструкция по развертыванию RPG Life Bot

## Требования к серверу
- Ubuntu 20.04 или новее / Debian 10 или новее
- Минимум 1 ГБ RAM
- Минимум 10 ГБ свободного места на диске
- Доступ в интернет

## Подготовка к развертыванию
1. Получите токен бота у @BotFather в Telegram
2. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/username/rpg_life_bot.git
   cd rpg_life_bot
   ```

## Быстрое развертывание
Для быстрого развертывания на новом сервере используйте скрипт `deploy.sh`:

```bash
./deploy.sh YOUR_BOT_TOKEN
```

Скрипт автоматически:
- Установит Docker и Docker Compose (если они отсутствуют)
- Создаст файл `.env` с нужными настройками
- Соберет Docker-образ бота
- Запустит PostgreSQL и Redis
- Выполнит миграции базы данных
- Запустит бота

## Обновление бота
Для обновления бота на существующем сервере:

```bash
./upgrade.sh
```

Скрипт:
- Получит последние изменения из репозитория
- Пересоберет контейнеры
- Выполнит новые миграции
- Перезапустит бота

## Создание резервной копии
Для создания резервной копии базы данных:

```bash
./backup.sh
```

Резервная копия будет сохранена в директории `backups/` с именем, содержащим текущую дату и время.

## Ручное управление
### Запуск бота
```bash
docker compose up -d
```

### Просмотр логов
```bash
docker compose logs -f rpg_bot
```

### Остановка бота
```bash
docker compose down
```

### Запуск миграций вручную
```bash
docker compose run --rm rpg_bot poetry run python -m alembic upgrade head
```

## Структура директорий
- `/logs` - хранит логи приложения
- `/storage` - хранит данные приложения
- `/backups` - хранит резервные копии базы данных

## Продакшн или разработка
Для продакшна бот автоматически использует PostgreSQL (`USE_SQLITE=false` в `.env`).  
Для локальной разработки можно использовать SQLite, установив `USE_SQLITE=true` в `.env`. 